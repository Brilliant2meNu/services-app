<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Services Area</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
        }
        .button {
            display: inline-block;
            margin: 10px;
            padding: 10px 20px;
            font-size: 16px;
            color: #fff;
            background-color: #007BFF;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .button:hover {
            background-color: #0056b3;
        }
        .green-button {
            background-color: #28a745;
        }
        .green-button:hover {
            background-color: #1e7e34;
        }
    </style>
</head>
<body>
    <img src="JMK.jpg" alt="JMK Logo" style="width: 200px;">
    <h1>Services Area</h1>
    <div>
        <img src="keyboard-icon_v1.png" alt="Keyboard Icon" style="width: 50px; margin-right: 10px;">
        <img src="microphone-icon_v1.png" alt="Microphone Icon" style="width: 50px;">
    </div>
    <div id="services"></div>
    <button class="button green-button" onclick="generateQRCode()">Generate QR Code</button>
    <button class="button" onclick="login('admin@example.com', 'admin123')">Login as Admin</button>
    <button class="button" onclick="validateSession()">Validate Session</button>

    <script type="module">
        // Import Supabase library
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

        // Initialize Supabase
        const supabaseUrl = "https://ovmdpupofhhudxhitoov.supabase.co";
        const supabaseAnonKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im92bWRwdXBvZmhodWR4aGl0b292Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc0MjM1ODksImV4cCI6MjA1Mjk5OTU4OX0.c9cIXQHFL487yOG44XFfD2D672cPpYzK-AKoCiZpjnk";
        const supabase = createClient(supabaseUrl, supabaseAnonKey);

        // Fetch services from Supabase
        async function fetchServices() {
            const { data, error } = await supabase
                .from('service_offerings')
                .select('*');

            if (error) {
                console.error('Error fetching services:', error);
                return;
            }

            const servicesDiv = document.getElementById('services');
            servicesDiv.innerHTML = data.map(service => `
                <button class="button">${service.service_name}</button>
            `).join('');
        }

        // Function for QR code generation (Placeholder)
        function generateQRCode() {
            alert("QR Code generation coming soon!");
        }

        // Chatbot Login and Session Management
        const backendUrl = "https://services-app-k83k.vercel.app/api/auth";

        async function login(email, password) {
            const response = await fetch(`${backendUrl}/login`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ email, password }),
            });
            const result = await response.json();
            if (response.ok) {
                localStorage.setItem("token", result.token);
                alert(`Welcome, ${result.role}!`);
            } else {
                alert(`Login failed: ${result.message}`);
            }
        }

        async function validateSession() {
            const token = localStorage.getItem("token");
            if (!token) {
                alert("No active session. Please log in.");
                return;
            }
            const response = await fetch(`${backendUrl}/validate-session`, {
                method: "POST",
                headers: { "Authorization": `Bearer ${token}` },
            });
            const result = await response.json();
            if (response.ok) {
                alert(`Session valid. Role: ${result.role}`);
            } else {
                alert(`Session invalid: ${result.error}`);
            }
        }

        // Fetch services on page load
        fetchServices();
    </script>
</body>
</html>
