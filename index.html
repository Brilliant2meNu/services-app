<script type="module">
    // Voice Recognition and Chat
    const voiceButton = document.getElementById('voiceButton');
    const chatInput = document.getElementById('chatInput');
    const chatOutput = document.getElementById('chatOutput');
    const sendButton = document.getElementById('sendButton');

    // Voice Recognition Functionality
    voiceButton.addEventListener('click', () => {
        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.lang = 'en-US';

        recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript;
            chatInput.value = transcript;
        };

        recognition.onerror = (err) => {
            console.error("Voice input error:", err);
            alert("Microphone access is needed!");
        };

        recognition.start();
    });

    // Sending User Message to Backend
    sendButton.addEventListener('click', async () => {
        const userInput = chatInput.value.trim();
        if (!userInput) {
            alert("Please enter a message or use the mic!");
            return;
        }

        const response = await fetchBackendGPTResponse(userInput);
        chatOutput.innerText = response;
    });

    // Function to Communicate with the Backend
    async function fetchBackendGPTResponse(userInput) {
        try {
            const response = await fetch("/api/chat", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ message: userInput })
            });

            if (!response.ok) {
                throw new Error("Failed to fetch response from the server");
            }

            const data = await response.json();
            return data.reply;
        } catch (error) {
            console.error("Error fetching GPT response:", error);
            return "Sorry, something went wrong.";
        }
    }
</script>
